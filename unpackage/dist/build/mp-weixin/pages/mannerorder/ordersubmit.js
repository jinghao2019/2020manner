(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mannerorder/ordersubmit"],{2317:function(n,t,e){"use strict";e.r(t);var o=e("b658"),r=e("87d7");for(var i in r)"default"!==i&&function(n){e.d(t,n,(function(){return r[n]}))}(i);e("ea18");var a,c=e("f0c5"),s=Object(c["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=s.exports},"87d7":function(n,t,e){"use strict";e.r(t);var o=e("df84"),r=e.n(o);for(var i in o)"default"!==i&&function(n){e.d(t,n,(function(){return o[n]}))}(i);t["default"]=r.a},"8e90":function(n,t,e){},b621:function(n,t,e){"use strict";(function(n){e("4262"),e("921b");o(e("66fd"));var t=o(e("2317"));function o(n){return n&&n.__esModule?n:{default:n}}n(t.default)}).call(this,e("543d")["createPage"])},b658:function(n,t,e){"use strict";var o,r=function(){var n=this,t=n.$createElement;n._self._c},i=[];e.d(t,"b",(function(){return r})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){return o}))},df84:function(n,t,e){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e={methods:{onLoad:function(){var n=this;this.orderInfo=this.$Util.getCache("current_order_info"),this.currentShop=this.$Util.getCache("current_shop"),this.orderInfo.map((function(t){n.hashKey.unshift(t.hashKey)})),this.options=[{title:"微信支付",note:"推荐使用微信支付",icon:"icon-weixinzhifu text-success",value:"wxpay"}],this.payMethod="wxpay"},pullWeiXinPay:function(t){var e=this;n.login({success:function(o){e.$H.get("/mannerdish/pay/payment?order_id="+t.order_id+"&code="+o.code,{},{token:!0,native:!0}).then((function(t){var o=t.data.data;n.requestPayment({timeStamp:o.timeStamp,nonceStr:o.nonceStr,package:o.package,signType:"MD5",paySign:o.paySign,success:function(t){n.switchTab({url:"/pages/mannerorder/ordertoday"}),console.log("success:"+JSON.stringify(t))},fail:function(t){e.callDelayCancel(),n.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1})},complete:function(){e.loading=!1}})})).catch((function(t){e.loading=!1,n.showToast({title:"支付失败",icon:"none"}),n.switchTab({url:"/pages/mannerorder/ordertoday"})}))},fail:function(t){console.log("fail",t),e.callDelayCancel(),e.loading=!1,n.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1})}})},openPayMethods:function(){var t=this,e=this;if(!this.loading){n.showLoading({title:"加载中"}),n.show;var o={hashKey:this.hashKey.join(","),flag:"cartPay",currentShopName:this.currentShop.name,currentShopId:this.currentShop.id};this.coupon.id>0&&(o.coupon_user_id=this.coupon.id),this.loading=!0,this.order_id&&this.order_sn?this.pullWeiXinPay(this.$data.order_result):this.$H.post("/mannerdish/order/orderSubmit",o,{token:!0}).then((function(n){return e.$data.order_id=n.order_id,e.$data.order_sn=n.order_id,e.$data.order_result=n,t.loading=!1,n})).then((function(n){t.pullWeiXinPay(n)})).catch((function(e){t.loading=!1,console.log(e),n.showToast({title:"创建订单失败",icon:"none"})}))}},callDelayCancel:function(){var t=this,e={order_id:this.order_result.order_id,order_sn:this.order_result.order_sn};this.$H.post("/mannerdish/order/orderDelayCancel",e,{token:!0}).then((function(n){console.log(n+"测试")})).catch((function(e){t.loading=!1,console.log(e),n.showToast({title:"取消订单失败",icon:"none"})}))}},computed:{totalPrice:function(){for(var n=0,t=0;t<this.orderInfo.length;t++)n+=this.orderInfo[t].num*this.orderInfo[t].showPrice*100;return n/100}},data:function(){return{loading:!1,orderInfo:[],total_price:45,currentShop:{},couponCount:0,coupon:{id:0,type:0,value:0},order_id:0,order_sn:"",hashKey:[],payMethod:"alipay",options:[],order_result:{}}}};t.default=e}).call(this,e("543d")["default"])},ea18:function(n,t,e){"use strict";var o=e("8e90"),r=e.n(o);r.a}},[["b621","common/runtime","common/vendor"]]]);